generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id           String        @id @default(uuid()) @db.Uuid
  email        String        @unique
  name         String?
  password     String
  image        String?
  role         UserRole      @default(CLIENT)
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt
  professional Professional?

  @@map("users")
}

model Client {
  id            String        @id @default(uuid()) @db.Uuid
  phone         String?
  company       String?
  cpf           String?       @unique
  birthDate     DateTime?
  tags          String[]      @default([])
  notes         String?
  preferences   Json?
  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @updatedAt
  address       String?
  city          String?
  state         String?
  zipCode       String?
  email         String
  name          String
  addressNumber String?
  appointments  Appointment[]

  @@map("clients")
}

model Professional {
  id           String        @id @default(uuid()) @db.Uuid
  specialty    String?
  availability Json?
  specialties  String[]
  workSchedule Json?
  commission   Decimal?      @db.Decimal(5, 2)
  phone        String?
  bio          String?
  userId       String        @unique @db.Uuid
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt
  appointments Appointment[]
  user         User          @relation(fields: [userId], references: [id], onDelete: Cascade)
  services     Service[]
  vacations    Vacation[]

  @@map("professionals")
}

model Vacation {
  id             String       @id @default(uuid()) @db.Uuid
  startDate      DateTime
  endDate        DateTime
  reason         String?
  professionalId String       @db.Uuid
  createdAt      DateTime     @default(now())
  updatedAt      DateTime     @updatedAt
  professional   Professional @relation(fields: [professionalId], references: [id], onDelete: Cascade)

  @@map("vacations")
}

model Service {
  id             String        @id @default(uuid()) @db.Uuid
  name           String
  description    String?
  duration       Int
  price          Decimal       @default(0) @db.Decimal(10, 2)
  professionalId String?       @db.Uuid
  createdAt      DateTime      @default(now())
  updatedAt      DateTime      @updatedAt
  appointments   Appointment[]
  professional   Professional? @relation(fields: [professionalId], references: [id], onDelete: Cascade)

  @@map("services")
}

model Appointment {
  id             String            @id @default(uuid()) @db.Uuid
  title          String?
  dateTime       DateTime
  duration       Int
  status         AppointmentStatus @default(SCHEDULED)
  notes          String?
  startTime      String
  endTime        String
  price          Decimal?          @db.Decimal(10, 2)
  clientId       String            @db.Uuid
  professionalId String            @db.Uuid
  serviceId      String?           @db.Uuid
  createdAt      DateTime          @default(now())
  updatedAt      DateTime          @updatedAt
  client         Client            @relation(fields: [clientId], references: [id])
  professional   Professional      @relation(fields: [professionalId], references: [id])
  service        Service?          @relation(fields: [serviceId], references: [id])

  @@index([dateTime])
  @@index([professionalId, dateTime])
  @@index([clientId])
  @@map("appointments")
}

enum UserRole {
  CLIENT
  PROFESSIONAL
  ADMIN
}

enum AppointmentStatus {
  SCHEDULED
  CONFIRMED
  IN_PROGRESS
  COMPLETED
  CANCELLED
  NO_SHOW
}
